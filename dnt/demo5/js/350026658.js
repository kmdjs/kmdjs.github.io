(function(b){var a=function(a,d,e,b,c){this.initialize(a,d,e,b,c)};a.prototype=new Container;a.prototype.Container_initialize=a.prototype.initialize;a.prototype.initialize=function(d,e,c,a,b){this.start=false;this.Container_initialize();this.progress=d;this.speed=e;this.width=c;this.height=a;this.color=b;this.shape=new Shape;this.shape.graphics.beginStroke(b).drawRect(0,0,c,a);this.addChild(this.shape);this.shape2=new Shape;this.shape2.alpha=.3;this.shape2.graphics.beginFill(b).drawRect(0,0,c,a);this.addChild(this.shape2);Ticker.addListener(this)};a.prototype.tick=function(){if(this.start){this.progress+=this.speed;var a=this.progress*this.width/100;if(a>0){this.shape2.graphics.clear();var b=this.color;if(MathHelp.getRandomNumber(1,10)>5&&this.progress<25)b="red";this.shape2.graphics.beginFill(b).drawRect(0,0,a,this.height)}else this.shape2.graphics.clear()}};a.prototype.begin=function(){this.start=true};a.prototype.end=function(){this.start=false;this.progress=100};b.TimeBar=a})(window);(function(b){var a=function(a,b,c){this.initialize(a,b,c)};a.prototype=new Container;a.prototype.Container_initialize=a.prototype.initialize;a.prototype.initialize=function(c,f,d){this.Container_initialize();this.position=c;this.speed=f;this.type=d;this.ignoreGravity=true;this.x=c.x*25+24;this.y=c.y*25+36;var e=new Shape,g=new Bitmap(content[0]),b,a;switch(d){case 1:b="rgba(255,0,0,1)";a="rgba(255, 0, 0, 0.5)";this.logo=new Bitmap(content[4]);break;case 2:b="rgba(0,255,0,1)";a="rgba(0, 255, 0, 0.5)";this.logo=new Bitmap(content[5]);break;case 3:b="rgba(0,0,255,1)";a="rgba(0, 0, 255, 0.5)";this.logo=new Bitmap(content[6]);break;case 4:b="rgba(122,122,0,1)";a="rgba(122, 122, 0, 0.4)";this.logo=new Bitmap(content[7]);break;case 5:b="rgba(0,122,42,1)";a="rgba(0, 122, 42, 0.4)";this.logo=new Bitmap(content[8]);break;case 6:b="rgba(122,30,222,1)";a="rgba(122, 30, 222, 0.5)";this.logo=new Bitmap(content[9]);break;case 7:b="rgba(255,122,0,1)";a="rgba(255, 122, 0, 0.5)";this.logo=new Bitmap(content[10]);break;case 8:b="rgba(205,0,60,1)";a="rgba(205, 0, 60, 0.3)";this.logo=new Bitmap(content[11]);break;case 9:b="rgba(50,205,205,1)";a="rgba(50, 205, 205, 0.5)";this.logo=new Bitmap(content[6]);this.logo.rotation=90;break;case 10:b="rgba(222,40,205,1)";a="rgba(222, 40, 205, 0.8)";this.logo=new Bitmap(content[9]);this.logo.rotation=45}if(this.logo){this.logo.x=12;this.logo.y=12;this.logo.regX=this.logo.image.width/2;this.logo.regY=this.logo.image.height/2}e.graphics.setStrokeStyle(.4).beginStroke(b).beginFill(a).drawRoundRectComplex(0,0,23,23,5,5,5,5);this.addChild(e,g);document.getElementById("showLogoCheck").checked&&this.addChild(this.logo);Ticker.addListener(this)};a.prototype.tick=function(){if(!this.ignoreGravity)this.speed.y+=4;this.x+=this.speed.x;this.y+=this.speed.y;if(this.y>1e3){Ticker.removeListener(this);this.parent.removeChild(this)}};a.prototype.addIcon=function(){switch(this.type){case 1:this.logo=new Bitmap(content[4]);break;case 2:this.logo=new Bitmap(content[5]);break;case 3:this.logo=new Bitmap(content[6]);break;case 4:this.logo=new Bitmap(content[7]);break;case 5:this.logo=new Bitmap(content[8]);break;case 6:this.logo=new Bitmap(content[9]);break;case 7:this.logo=new Bitmap(content[10]);break;case 8:this.logo=new Bitmap(content[11]);break;case 9:this.logo=new Bitmap(content[6]);this.logo.rotation=90;break;case 10:this.logo=new Bitmap(content[9]);this.logo.rotation=45}if(this.logo){this.logo.x=12;this.logo.y=12;this.logo.regX=this.logo.image.width/2;this.logo.regY=this.logo.image.height/2}this.addChild(this.logo)};a.prototype.removeIcon=function(){this.removeChild(this.logo)};b.Block=a})(window);(function(b){var a={};a.Play=function(b){var a=document.getElementById(b);a.play&&a.play()};b.Sound=a})(window);(function(b){a.prototype=new Container;function a(c,e,d){var b=this;b.super_initialize=a.prototype.initialize;b.disabled=null;b.enabled=null;b.overDown=null;b.isEnabled=true;b.initialize=function(c,a,d){b.super_initialize();b.disabled=c;b.enabled=a;b.overDown=d;if(b.disabled){b.disabled.regX=b.disabled.image.width/2;b.disabled.regY=b.disabled.image.height/2;b.addChild(b.disabled)}if(b.enabled){b.enabled.regX=b.enabled.image.width/2;b.enabled.regY=b.enabled.image.height/2;b.addChild(b.enabled)}if(!b.overDown)b.overDown=a.clone();else{b.overDown.regX=b.overDown.image.width/2;b.overDown.regY=b.overDown.image.height/2}b.addChild(b.overDown);b.setEnabled(b.isEnabled);if(Touch.isSupported()){b.onMouseOver=null;b.onMouseOut=null}else{b.onPress=null;b.handleMouseUp=null}};b.onPress=function(a){trace("CanvasButton.onPress");if(b.isEnabled){b.overDown.visible=true;a.onMouseUp=function(a){b.handleMouseUp(a)}}};b.handleMouseUp=function(){if(b.isEnabled)b.overDown.visible=false};b.onMouseOver=function(){if(b.isEnabled){b.enabled.visible=false;b.overDown.visible=true}};b.onMouseOut=function(){if(b.isEnabled){b.enabled.visible=true;b.overDown.visible=false}};b.setEnabled=function(a){b.isEnabled=a;b.mouseEnabled=a;if(!a&&b.disabled){b.disabled.visible=true;b.enabled.visible=false;b.overDown.visible=false}else{b.enabled.visible=true;b.overDown.visible=false;if(b.disabled)b.disabled.visible=false}};c&&b.initialize(d,c,e)}b.CanvasButton=a})(window);var preload=new PreloadJS,manifest,canvas,stage,bar,successionHitBar,successionHitCount=0,successionHitTxt,blocks=[],pathColor="green",pathPointR=6,total=0,t,playBtn,shapeCov;canvas=document.getElementById("myCanvas");stage=new Stage(canvas);Touch.enable(stage);stage.enableMouseOver(10);var directiveContainer=new Container,showIcon=false,messageField=new Text("Loading","bold 24px Arial","#000000");messageField.maxWidth=1e3;messageField.textAlign="center";messageField.x=canvas.width/2;messageField.y=canvas.height/2;stage.addChild(messageField);stage.update();var loadingInterval=setInterval(updateLoading,200);window.onload=function(){manifest=[{src:"img/shape58.png",id:"image0"},{src:"img/shape61.png",id:"image1"},{src:"img/shape137.png",id:"image2"},{src:"img/playBtn.png",id:"image3"},{src:"img/1.png",id:"image4"},{src:"img/2.png",id:"image5"},{src:"img/3.png",id:"image6"},{src:"img/4.png",id:"image7"},{src:"img/5.png",id:"image8"},{src:"img/6.png",id:"image9"},{src:"img/7.png",id:"image10"},{src:"img/8.png",id:"image11"},{src:"sound/1.mp3",id:"sound0"},{src:"sound/2.mp3",id:"sound1"},{src:"sound/bg.mp3",id:"sound2"}];preload.onComplete=handleComplete;preload.onFileLoad=handleFileLoad;preload.installPlugin(SoundJS);preload.loadManifest(manifest)};var content=[];function handleFileLoad(a){content.push(a.result)}function handleComplete(){clearInterval(loadingInterval);init()}function updateLoading(){messageField.text="Loading "+(preload.progress*100|0)+"%";stage.update()}function init(){var c=new Bitmap(content[2]);stage.addChild(c);successionHitBar=new TimeBar(100,-2,100,10,"green");successionHitBar.x=325;successionHitBar.y=10;stage.addChild(successionHitBar);bar=new TimeBar(100,-.1,220,20,"green");bar.x=25;bar.y=10;stage.addChild(bar);t=new Text;t.y=25;t.x=470;t.font="20pt Calibri";t.text="分数："+total;stage.addChild(t);successionHitTxt=new Text;successionHitTxt.y=25;successionHitTxt.x=400;successionHitTxt.font="10pt Calibri";successionHitTxt.text="连击："+successionHitCount;stage.addChild(successionHitTxt);var a=new Bitmap(content[3]);a.sourceRect=new Rectangle(0,0,128,38);var b=new Bitmap(content[3]);b.sourceRect=new Rectangle(0,38,129,39);randomGenerateBlock();stage.addChild(directiveContainer);shapeCov=new Shape;shapeCov.graphics.beginFill("rgba(0,0,0,0.2)").drawRect(0,0,canvas.width,canvas.height);stage.addChild(shapeCov);playBtn=new CanvasButton(a,b);playBtn.onPress=function(a){playBtn.overDown.visible=false;playBtn.enabled.visible=true;playBtn.enabled.x++;playBtn.enabled.y++;a.onMouseUp=function(){Tween.get(t).to({x:470,y:25},500).call(function(){total=0});Tween.get(playBtn).to({alpha:0},500).call(function(){for(var a=0;a<blocks.length;a++){blocks[a].ignoreGravity=false;blocks[a].speed={x:MathHelp.getRandomNumber(-10,10),y:MathHelp.getRandomNumber(-30,0)};blocks.splice(a--,1)}}).wait(1e3).call(function(){bar.start=true;successionHitBar.begin();randomGenerateBlock();shapeCov.visible=false;stage.onMouseDown=handleMouseDown;stage.onMouseMove=handleMouseMove;bar.start=true;playBtn.visible=false;playBtn.overDown.visible=true;playBtn.enabled.visible=false;playBtn.enabled.x--;playBtn.enabled.y--})}};playBtn.x=310;playBtn.y=230;stage.addChild(playBtn);Ticker.addListener(window)}var preX,preY;function handleMouseMove(){var b=Math.floor((stage.mouseX-25)/25),c=Math.floor((stage.mouseY-36)/25);if(preX===b&&preY===c)return;directiveContainer.removeAllChildren();preX=b;preY=c;var d=JSLINQ(blocks).Count(function(a){return a.position.x===b&&a.position.y===c});if(d!==1)if(document.getElementById("helpCheck").checked)updateHelp(b,c);else{var e=b*25+24,f=c*25+36,a=new Shape;a.alpha=0;a.graphics.beginFill("#D7D7D7").drawRect(e,f,25,25);stage.addChild(a);Tween.get(a).to({alpha:1},100).to({alpha:0},100).call(function(){try{a&&a.parent&&a.parent.removeChild(a)}catch(b){}})}}function handleMouseDown(){var b=Math.floor((stage.mouseX-25)/25),c=Math.floor((stage.mouseY-36)/25),n=JSLINQ(blocks).Count(function(a){return a.position.x===b&&a.position.y===c});if(n!==1){var e=[],i=JSLINQ(blocks).Where(function(a){return a.position.y===c&&a.position.x<b}).OrderByDescending(function(a){return a.position.x}).items,j=JSLINQ(blocks).Where(function(a){return a.position.y===c&&a.position.x>b}).OrderBy(function(a){return a.position.x}).items,k=JSLINQ(blocks).Where(function(a){return a.position.x===b&&a.position.y<c}).OrderByDescending(function(a){return a.position.y}).items,l=JSLINQ(blocks).Where(function(a){return a.position.x===b&&a.position.y>c}).OrderBy(function(a){return a.position.y}).items;i.length!==0&&e.push(i[0]);j.length!==0&&e.push(j[0]);k.length!==0&&e.push(k[0]);l.length!==0&&e.push(l[0]);for(var m=0,d=[],h=1;h<11;h++){var f=JSLINQ(e).Where(function(a){return a.type===h});if(f.items.length>1){m=1;for(var g=0;g<f.items.length;g++){removeFromBlocks(f.items[g]);d.push(f.items[g])}}}if(m===0){SoundJS.play("sound1",SoundJS.INTERUPT_LATE);bar.progress-=5;successionHitCount=0;successionHitBar.progress=100;pathColor="green";pathPointR=6}if(d.length>0){SoundJS.play("sound0",SoundJS.INTERRUPT_ANY);document.getElementById("helpCheck").checked&&updateHelp(b,c);successionHitBar.progress=100;successionHitCount++;total+=d.length*10;if(successionHitCount>1){total+=d.length*successionHitCount;var a=new Text;a.x=stage.mouseX-35;a.y=stage.mouseY;a.color="green";a.font="bold 15pt Calibri ";a.text="连击+"+successionHitCount;stage.addChild(a);pathColor="red";pathPointR=8;Tween.get(a).to({alpha:0,y:stage.mouseY-30},400).call(function(){this.parent.removeChild(this)})}playEliminate(d,b,c)}}}function updateHelp(c,d){var g=JSLINQ(blocks).Where(function(a){return a.position.y===d&&a.position.x<c}).OrderByDescending(function(a){return a.position.x}).items,h=JSLINQ(blocks).Where(function(a){return a.position.y===d&&a.position.x>c}).OrderBy(function(a){return a.position.x}).items,i=JSLINQ(blocks).Where(function(a){return a.position.x===c&&a.position.y<d}).OrderByDescending(function(a){return a.position.y}).items,j=JSLINQ(blocks).Where(function(a){return a.position.x===c&&a.position.y>d}).OrderBy(function(a){return a.position.y}).items;if(g.length!==0)for(var a=g[0].position.x;a<c+1;a++){var e=a*25+34,f=d*25+46,b=new Shape;b.graphics.beginFill("#BB6AB4").drawCircle(e,f,3);directiveContainer.addChild(b)}if(h.length!==0)for(var a=h[0].position.x;a>c-1;a--){var e=a*25+34,f=d*25+46,b=new Shape;b.graphics.beginFill("#BB6AB4").drawCircle(e,f,3);directiveContainer.addChild(b)}if(i.length!==0)for(var a=i[0].position.y;a<d+1;a++){var e=c*25+34,f=a*25+46,b=new Shape;b.graphics.beginFill("#BB6AB4").drawCircle(e,f,3);directiveContainer.addChild(b)}if(j.length!==0)for(var a=j[0].position.y;a>d-1;a--){var e=c*25+34,f=a*25+46,b=new Shape;b.graphics.beginFill("#BB6AB4").drawCircle(e,f,3);directiveContainer.addChild(b)}}function playEliminate(d,e,f){for(var c=0;c<d.length;c++){if(d[c].position.x<e)for(var b=d[c].position.x;b<e+1;b++){var g=b*25+34,h=f*25+46,a=new Shape;a.alpha=0;a.graphics.beginFill(pathColor).drawCircle(g,h,pathPointR);stage.addChild(a);Tween.get(a).to({alpha:1},200).to({alpha:0},200).call(function(){this&&this.parent&&this.parent.removeChild(this)})}if(d[c].position.x>e)for(var b=d[c].position.x;b>e-1;b--){var g=b*25+34,h=f*25+46,a=new Shape;a.alpha=0;a.graphics.beginFill(pathColor).drawCircle(g,h,pathPointR);stage.addChild(a);Tween.get(a).to({alpha:1},200).to({alpha:0},200).call(function(){this&&this.parent&&this.parent.removeChild(this)})}if(d[c].position.y>f)for(var b=d[c].position.y;b>f-1;b--){var g=e*25+34,h=b*25+46,a=new Shape;a.alpha=0;a.graphics.beginFill(pathColor).drawCircle(g,h,pathPointR);stage.addChild(a);Tween.get(a).to({alpha:1},200).to({alpha:0},200).call(function(){this&&this.parent&&this.parent.removeChild(this)})}if(d[c].position.y<f)for(var b=d[c].position.y;b<f+1;b++){var g=e*25+34,h=b*25+46,a=new Shape;a.alpha=0;a.graphics.beginFill(pathColor).drawCircle(g,h,pathPointR);stage.addChild(a);Tween.get(a).to({alpha:1},200).to({alpha:0},200).call(function(){this&&this.parent&&this.parent.removeChild(this)})}}}function removeFromBlocks(b){for(var a=0;a<blocks.length;a++)if(b.position.x===blocks[a].position.x&&b.position.y===blocks[a].position.y){blocks[a].ignoreGravity=false;blocks[a].speed={x:MathHelp.getRandomNumber(-10,10),y:MathHelp.getRandomNumber(-30,0)};blocks.splice(a--,1)}}function randomGenerateBlock(){blocks.length=0;for(var a=0;a<23;a++)for(var b=0;b<15;b++)if(MathHelp.getRandomNumber(1,100)>50){var c=new Block({x:a,y:b},{x:0,y:0},MathHelp.getRandomNumber(1,10));blocks.push(c);stage.addChild(c)}}function removeAllBlocks(){for(var a=0;a<blocks.length;a++)stage.removeChild(blocks[a])}function tick(){if(successionHitBar.progress<=0){successionHitBar.progress=100;successionHitCount=0;pathColor="green";pathPointR=6}successionHitTxt.text="连击："+successionHitCount;if(bar.progress<=0){pathColor="green";pathPointR=6;bar.progress=100;bar.start=false;successionHitBar.end();successionHitCount=0;stage.removeChild(shapeCov);stage.addChild(shapeCov);stage.removeChild(t);stage.addChild(t);Tween.get(t).to({x:240,y:150},500).call(function(){shapeCov.visible=true;playBtn.alpha=1;playBtn.visible=true;stage.onMouseDown=null;stage.onMouseMove=null;stage.removeChild(playBtn);stage.addChild(playBtn)})}t.text="分数："+total;stage.update()}function chageLogeShowState(){if(document.getElementById("showLogoCheck").checked)for(var a=0;a<blocks.length;a++)blocks[a].addIcon();else for(var a=0;a<blocks.length;a++)blocks[a].removeIcon()}