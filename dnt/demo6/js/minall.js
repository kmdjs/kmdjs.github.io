(function(b){var a=function(a,b,c){this.initialize(a,b,c)};a.prototype=new Container;a.prototype.Container_initialize=a.prototype.initialize;a.prototype.initialize=function(a,c,e){this.Container_initialize();this.CannonBmp=new Bitmap(a);this.level=c;var d={frames:[[3,0,66,68,0,33,66],[2,72,66,69,0,34,69],[4,147,66,69,0,32,69],[5,219,66,69,0,31,69],[2,294,66,69,0,34,68]],animations:{fire:[0,4,"fire",1],show:[0,0,"",10]},images:[a]},b=new SpriteSheet(d);this.bmpAnim=new BitmapAnimation(b);this.bmpAnim.onAnimationEnd=function(){this.stop()};this.bmpAnim.gotoAndPlay("show");this.addChild(this.bmpAnim);this.rotation=e;this._turnRightCmd=false;this._trunAngel=0};a.prototype.fire=function(){this.bmpAnim.gotoAndPlay("fire");var a=new Bullet(mgMain.imgs[5],this.level,this.rotation,10);a.x=this.x;a.y=this.y;a.x+=70*Math.sin(this.rotation*Math.PI/180);a.y-=70*Math.cos(this.rotation*Math.PI/180);mgMain.stage.addChild(a);mgMain.bullets.push(a);Ticker.addListener(a)};b.Cannon=a})(window);window.onload=function(){initGame()};var mgMain={},fishs=[];function initGame(){mgMain=new MGMain;mgMain.init();loadImages()}function loadImages(){for(var b=new PxLoader,d=[],c=["game_bg_2_hd.jpg","fish2.png","bigreturn.png","bottom.png","cannon1.png","bullet.png","web.png","coinAni1.png"],a=0;a<c.length;a++)mgMain.imgs[a]=b.addImage(PATH+c[a]);b.addCompletionListener(function(){Touch.enable(mgMain.stage);mgMain.stage.enableMouseOver(10);var l=new Bitmap(mgMain.imgs[0]),k=new Bitmap(mgMain.imgs[2]),c=new Bitmap(mgMain.imgs[3]);c.x=120;c.y=700;var d=new Bitmap(mgMain.imgs[3]);d.sourceRect=new Rectangle(1,73,42,29);var i=new Bitmap(mgMain.imgs[3]);i.sourceRect=new Rectangle(45,73,44,29);var e=new Bitmap(mgMain.imgs[3]);e.sourceRect=new Rectangle(91,73,42,29);var j=new Bitmap(mgMain.imgs[3]);j.sourceRect=new Rectangle(135,73,44,29);var f=new Bitmap(mgMain.imgs[3]);f.sourceRect=new Rectangle(45,73,44,29);var g=new Bitmap(mgMain.imgs[3]);g.sourceRect=new Rectangle(135,73,44,29);var h=k.clone();h.scaleX=h.scaleY=1.035;var a=new MGButton(null,i,f);a.addChildAt(d,0);var b=new MGButton(null,j,g);b.addChildAt(e,0);a.onPress=function(b){a.overDown.visible=false;b.onMouseUp=function(){a.overDown.visible=true}};b.onPress=function(a){b.overDown.visible=false;a.onMouseUp=function(){b.overDown.visible=true}};a.x=605;a.y=735;b.x=455;b.y=735;mgMain.cannon=new Cannon(mgMain.imgs[4],1,0);mgMain.cannon.visible=true;mgMain.cannon.x=550;mgMain.cannon.y=765;mgMain.fpsLabel=new Text("-- FPS","bold 24px Arial","#fff");mgMain.fpsLabel.x=10;mgMain.fpsLabel.y=20;mgMain.fpsLabel.alpha=.8;mgMain.stage.addChild(l,c,a,b,mgMain.cannon,mgMain.fpsLabel);mgMain.initFishs();Ticker.setFPS(60);Ticker.addListener(mgMain)});b.start()}function MGMain(){var a=this;a.imgs=[];a.canvas={};a.initWidth=0;a.initHeight=0;a.gameArea={};a.stage={};a.fpsLabel={};a.cannon={};a.isInitLoad=true;a.bullets=[];a.resizeGame=function(){var e=4/3,b=window.innerWidth,c=window.innerHeight,f=b/c;if(f>e)b=c*e;else c=b/e;if(b>1024||c>768){b=1024;c=768}a.gameArea.style.width=b+"px";a.gameArea.style.height=c+"px";a.gameArea.style.marginTop=-c/2+"px";a.gameArea.style.marginLeft=-b/2+"px";var d;if(!a.isInitLoad){d=b/a.canvas.width;trace("newWidth: "+b+" newHeight: "+c+" scaleStage: "+d);a.stage.scaleX=a.stage.scaleX*d;a.stage.scaleY=a.stage.scaleY*d}else{d=b/1024;trace("newWidth: "+b+" newHeight: "+c+" scaleStage: "+d);a.stage.scaleX=a.stage.scaleX*d;a.stage.scaleY=a.stage.scaleY*d;a.isInitLoad=false}a.canvas.width=b;a.canvas.height=c;if(a.initWidth==0){a.initWidth=a.canvas.width;a.initHeight=a.canvas.height}};a.init=function(){window.addEventListener("resize",a.resizeGame,false);a.canvas=document.getElementById("gameCanvas");a.gameArea=document.getElementById("gameArea");a.stage=new Stage(a.canvas);a.resizeGame();a.canvas.addEventListener("mousedown",function(d){var c=a.getRelativePos(d);if(c.y/a.canvas.height>.95)return;var b=Math.atan((a.canvas.height-c.y)/(c.x-a.canvas.width/2))*180/Math.PI;if(b>0)a.cannon.rotation=90-b;else a.cannon.rotation=-90-b;a.cannon.fire()});a.canvas.addEventListener("touchstart",function(d){d.preventDefault();var c=a.getRelativePos(d);if(c.y/a.canvas.height>.95)return;var b=Math.atan((a.canvas.height-c.y)/(c.x-a.canvas.width/2))*180/Math.PI;if(b>0)a.cannon.rotation=90-b;else a.cannon.rotation=-90-b;a.cannon.fire()})};a.getRelativePos=function(a){var b=this.canvas.getBoundingClientRect(),c,d;if(a.touches){c=a.touches[0].pageX-b.left;d=a.touches[0].pageY-b.top}else{c=a.clientX-b.left;d=a.clientY-b.top}return{x:c,y:d}};a.tick=function(){for(var b=0;b<fishs.length;b++)if(fishs[b].x<-400||fishs[b].x>1324||fishs[b].y<-400||fishs[b].y>1068){Ticker.removeListener(fishs[b]);mgMain.stage.removeChild(fishs[b]);fishs.splice(b--,1)}fishs.length<40&&mgMain.initFish();mgMain.fpsLabel.text=Math.round(Ticker.getMeasuredFPS())+" FPS";for(var b=0;b<mgMain.bullets.length;b++)if(mgMain.bullets[b].x<-400||mgMain.bullets[b].x>1324||mgMain.bullets[b].y<-400||mgMain.bullets[b].y>1068||mgMain.bullets[b].removeTag){Ticker.removeListener(mgMain.bullets[b]);mgMain.stage.removeChild(mgMain.bullets[b]);mgMain.bullets.splice(b--,1)}for(var b=0;b<mgMain.bullets.length;b++)for(var d=0;d<fishs.length;d++){var f=new Vector2(mgMain.bullets[b].x,mgMain.bullets[b].y),i=f.distanceToSquared(new Vector2(fishs[d].x,fishs[d].y));if(i<900){mgMain.bullets[b].removeTag=true;var e=new Net(mgMain.bullets[b].level);e.x=mgMain.bullets[b].x;e.y=mgMain.bullets[b].y;mgMain.stage.addChild(e);for(var c=0;c<fishs.length;c++){var g=f.distanceToSquared(new Vector2(fishs[c].x,fishs[c].y));if(g<fishs[c].radius*fishs[c].radius){var h=MathHelp.getRandomNumber(0,100);if(h>20){fishs[c].speed=0;fishs[c].struggle();Ticker.removeListener(fishs[c]);fishs.splice(c--,1)}}}}}a.stage.update()};a.initFishs=function(){for(var b=MathHelp.getRandomNumber,c=0;c<40;c++){var d=MathHelp.getRandomNumber(0,1e3),e=MathHelp.getRandomNumber(0,1e3),a=new Fish(mgMain.imgs[1],2,b(1,4),b(0,360));a.x=d;a.y=e;fishs.push(a);mgMain.stage.addChild(a);Ticker.addListener(a)}};a.initFish=function(){var b=MathHelp.getRandomNumber,c=MathHelp.getRandomNumber(-300,0),d=MathHelp.getRandomNumber(0,700),a=new Fish(mgMain.imgs[1],2,b(1,4),b(0,360));a.x=c;a.y=d;fishs.push(a);mgMain.stage.addChild(a);Ticker.addListener(a)}}(function(b){var a=function(a,b,c,d){this.initialize(a,b,c,d)};a.prototype=new Container;a.prototype.Container_initialize=a.prototype.initialize;a.prototype.initialize=function(a,d,e,f){this.Container_initialize();this.FishBmp=new Bitmap(a);this.speed=e;var b;switch(d){case 1:this.BulletBmp.sourceRect=new Rectangle(86,0,24,27);break;case 2:b={frames:[[3,4,74,58,0,46,19],[7,67,70,54,0,45,19],[3,136,74,44,0,49,14],[4,199,73,50,0,46.5,14],[3,256,72,57,0,40,18],[10,320,66,57,0,37,18],[4,383,73,59,0,40.5,20],[9,448,66,55,0,37,18]],animations:{swim:[0,3,"swim",MathHelp.getRandomNumber(7,12)],struggle:[4,7,"struggle",10]},images:[a]};this.radius=50;break;case 3:this.BulletBmp.sourceRect=new Rectangle(45,73,44,29);break;case 4:this.BulletBmp.sourceRect=new Rectangle(45,73,44,29);break;case 5:this.BulletBmp.sourceRect=new Rectangle(45,73,44,29);break;case 6:this.BulletBmp.sourceRect=new Rectangle(45,73,44,29);break;case 7:this.BulletBmp.sourceRect=new Rectangle(45,73,44,29)}var c=new SpriteSheet(b);this.bmpAnim=new BitmapAnimation(c);this.bmpAnim.onAnimationEnd=function(){};this.swim();this.addChild(this.bmpAnim);this.rotation=f;this._turnRightCmd=false;this._trunAngel=0};a.prototype.tick=function(){if(this._turnRightCmd&&this._trunAngel<90){this.rotation++;this._trunAngel++}else{this._turnRightCmd=false;this._trunAngel=0}this.x+=this.speed*Math.cos(this.rotation*Math.PI/180);this.y+=this.speed*Math.sin(this.rotation*Math.PI/180)};a.prototype.turnRight90=function(){this._turnRightCmd=true};a.prototype.turnRight=function(){var a=MathHelp.getRandomNumber(0,100);if(a>50)this.rotation++};a.prototype.turnLeft=function(){var a=MathHelp.getRandomNumber(0,100);if(a>50)this.rotation--};a.prototype.swim=function(){this.bmpAnim.currentAnimation!=="swim"&&this.bmpAnim.gotoAndPlay("swim")};a.prototype.struggle=function(){this.bmpAnim.currentAnimation!=="struggle"&&this.bmpAnim.gotoAndPlay("struggle");var a=this;this.bmpAnim.onAnimationEnd=function(){var b=new Coin;b.x=a.x;b.y=a.y;mgMain.stage.addChild(b);Tween.get(b).to({x:240,y:730},1500).call(function(){b.parent.removeChild(b)});a.parent.removeChild(a)}};b.Fish=a})(window);(function(b){var a=function(a,b,d,c){this.initialize(a,b,d,c)};a.prototype=new Container;a.prototype.Container_initialize=a.prototype.initialize;a.prototype.initialize=function(b,a,d,c){this.Container_initialize();this.BulletBmp=new Bitmap(b);switch(a){case 1:this.BulletBmp.sourceRect=new Rectangle(86,0,24,27);this.BulletBmp.regX=12;this.BulletBmp.regY=27;break;case 2:this.BulletBmp.sourceRect=new Rectangle(45,73,44,29);break;case 3:this.BulletBmp.sourceRect=new Rectangle(45,73,44,29);break;case 4:this.BulletBmp.sourceRect=new Rectangle(45,73,44,29);break;case 5:this.BulletBmp.sourceRect=new Rectangle(45,73,44,29);break;case 6:this.BulletBmp.sourceRect=new Rectangle(45,73,44,29);break;case 7:this.BulletBmp.sourceRect=new Rectangle(45,73,44,29)}this.speed=c;this.rotation=d;this.level=a;this.addChild(this.BulletBmp)};a.prototype.tick=function(){this.x+=this.speed*Math.sin(this.rotation*Math.PI/180);this.y-=this.speed*Math.cos(this.rotation*Math.PI/180)};a.prototype.checkHit=function(){for(var a=0;a<fishs.length;a++){var d=new Vector2(this.x,this.y).distanceToSquared(new Vector2(fishs[a].x,fishs[a].y));if(d<fishs[a].radius*fishs[a].radius){Ticker.removeListener(this);this.parent.removeChild(this);var b=new Net(this.level);b.x=this.x;b.y=this.y;mgMain.stage.addChild(b);var c=MathHelp.getRandomNumber(0,100);if(c>50){fishs[a].speed=0;fishs[a].struggle();Ticker.removeListener(fishs[a]);fishs.splice(a--,1)}}}};b.Bullet=a})(window);(function(b){var a=function(a){this.initialize(a)};a.prototype=new Container;a.prototype.Container_initialize=a.prototype.initialize;a.prototype.initialize=function(b){this.Container_initialize();this.NetBmp=new Bitmap(mgMain.imgs[6]);this.NetBmp.scaleX=this.NetBmp.scaleY=.2;switch(b){case 1:var a=[321,359,113,111,54.5,58];this.NetBmp.sourceRect=new Rectangle(a[0],a[1],a[2],a[3]);this.NetBmp.regX=a[4];this.NetBmp.regY=a[5];this.radius=50;break;case 2:this.NetBmp.sourceRect=new Rectangle(45,73,44,29);break;case 3:this.NetBmp.sourceRect=new Rectangle(45,73,44,29);break;case 4:this.NetBmp.sourceRect=new Rectangle(45,73,44,29);break;case 5:this.NetBmp.sourceRect=new Rectangle(45,73,44,29);break;case 6:this.NetBmp.sourceRect=new Rectangle(45,73,44,29);break;case 7:this.NetBmp.sourceRect=new Rectangle(45,73,44,29)}this.x=200;this.y=200;var d=this;this.addChild(this.NetBmp);var c=Tween.get(this.NetBmp).to({scaleX:1,scaleY:1},200,Ease.backOut).wait(500).call(function(){this.parent.removeChild(this)})};b.Net=a})(window);(function(b){var a=function(a){this.initialize(a)};a.prototype=new Container;a.prototype.Container_initialize=a.prototype.initialize;a.prototype.initialize=function(){this.Container_initialize();var b={frames:{width:60,numFrames:10,regX:30,regY:30,height:60},animations:{rotate:[0,9,"rotate"]},images:[mgMain.imgs[7]]},a=new SpriteSheet(b);this.bmpAnim=new BitmapAnimation(a);this.bmpAnim.onAnimationEnd=function(){};this.bmpAnim.gotoAndPlay("rotate");this.addChild(this.bmpAnim)};a.prototype.rotate=function(){this.bmpAnim.gotoAndPlay("rotate")};b.Coin=a})(window)