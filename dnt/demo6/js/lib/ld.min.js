function PxLoader(c){c=c||{};if(c.statusInterval==null)c.statusInterval=5e3;if(c.loggingDelay==null)c.loggingDelay=2e4;if(c.noProgressTimeout==null)c.noProgressTimeout=Infinity;var b=[],d=[],h,f=+new Date,a={QUEUED:0,WAITING:1,LOADED:2,ERROR:3,TIMEOUT:4},k=function(a){return a==null?[]:Array.isArray(a)?a:[a]};this.add=function(c){c.tags=new PxLoaderTags(c.tags);if(c.priority==null)c.priority=Infinity;b.push({resource:c,state:a.QUEUED})};this.addProgressListener=function(a,b){d.push({callback:a,tags:new PxLoaderTags(b)})};this.addCompletionListener=function(a,b){d.push({tags:new PxLoaderTags(b),callback:function(b){b.completedCount===b.totalCount&&a()}})};var i=function(a){a=k(a);var b=function(f){for(var e=f.resource,b=Infinity,d=0;d<e.tags.length;d++)for(var c=0;c<Math.min(a.length,b);c++){if(e.tags[d]==a[c]&&c<b){b=c;if(b===0)break}if(b===0)break}return b};return function(a,c){var d=b(a),e=b(c);return d<e?-1:d>e?1:a.priority<c.priority?-1:a.priority>c.priority?1:0}};this.start=function(f){h=+new Date;var e=i(f);b.sort(e);for(var c=0,j=b.length;c<j;c++){var d=b[c];d.status=a.WAITING;d.resource.start(this)}setTimeout(g,100)};var g=function(){for(var e=false,i=+new Date-f,k=i>=c.noProgressTimeout,j=i>=c.loggingDelay,h=0,m=b.length;h<m;h++){var d=b[h];if(d.status!==a.WAITING)continue;d.resource.checkStatus();if(d.status===a.WAITING)if(k)d.resource.onTimeout();else e=true}j&&e&&l();e&&setTimeout(g,c.statusInterval)};this.isBusy=function(){for(var c=0,d=b.length;c<d;c++)if(b[c].status===a.QUEUED||b[c].status===a.WAITING)return true;return false};var e=function(i,l){for(var e=null,c=0,m=b.length;c<m;c++)if(b[c].resource===i){e=b[c];break}if(e==null||e.status!==a.WAITING)return;e.status=l;f=+new Date;for(var n=i.tags.length,c=0,k=d.length;c<k;c++){var h=d[c],g;if(h.tags.length===0)g=true;else g=i.tags.contains(h.tags);g&&j(e,h)}};this.onLoad=function(b){e(b,a.LOADED)};this.onError=function(b){e(b,a.ERROR)};this.onTimeout=function(b){e(b,a.TIMEOUT)};var j=function(c,f){for(var h=0,i=0,g=0,j=b.length;g<j;g++){var d=b[g],e=false;if(f.tags.length===0)e=true;else e=d.resource.tags.contains(f.tags);if(e){i++;if(d.status===a.LOADED||d.status===a.ERROR||d.status===a.TIMEOUT)h++}}f.callback({resource:c.resource,loaded:c.status===a.LOADED,error:c.status===a.ERROR,timeout:c.status===a.TIMEOUT,completedCount:h,totalCount:i})},l=this.log=function(g){if(!window.console)return;var f=Math.round((+new Date-h)/1e3);window.console.log("PxLoader elapsed: "+f+" sec");for(var e=0,i=b.length;e<i;e++){var d=b[e];if(!g&&d.status!==a.WAITING)continue;var c="PxLoader: #"+e+" "+d.resource.getName();switch(d.status){case a.QUEUED:c+=" (Not Started)";break;case a.WAITING:c+=" (Waiting)";break;case a.LOADED:c+=" (Loaded)";break;case a.ERROR:c+=" (Error)";break;case a.TIMEOUT:c+=" (Timeout)"}if(d.resource.tags.length>0)c+=" Tags: ["+d.resource.tags.join(",")+"]";window.console.log(c)}}}function PxLoaderTags(a){this.array=[];this.object={};this.value=null;this.length=0;if(a!==null&&a!==undefined){if(Array.isArray(a))this.array=a;else if(typeof a==="object")for(var c in a)this.array.push(c);else{this.array.push(a);this.value=a}this.length=this.array.length;for(var b=0;b<this.length;b++)this.object[this.array[b]]=true}this.contains=function(a){if(this.length===0||a.length===0)return false;else if(this.length===1)return a.length===1?this.value===a.value:a.object.hasOwnProperty(this.value);else if(a.length<this.length)return a.contains(this);else{for(var b in this.object)if(a.object[b])return true;return false}}}if(!Array.isArray)Array.isArray=function(a){return Object.prototype.toString.call(a)=="[object Array]"};function PxLoaderImage(g,i,h){var a=this,b=null;this.img=new Image;this.tags=i;this.priority=h;var d=function(){if(a.img.readyState=="complete"){c();b.onLoad(a)}},f=function(){c();b.onLoad(a)},e=function(){c();b.onError(a)},c=function(){a.unbind("load",f);a.unbind("readystatechange",d);a.unbind("error",e)};this.start=function(c){b=c;a.bind("load",f);a.bind("readystatechange",d);a.bind("error",e);a.img.src=g};this.checkStatus=function(){if(a.img.complete){c();b.onLoad(a)}};this.onTimeout=function(){c();if(a.img.complete)b.onLoad(a);else b.onTimeout(a)};this.getName=function(){return g};this.bind=function(c,b){if(a.img.addEventListener)a.img.addEventListener(c,b,false);else a.img.attachEvent&&a.img.attachEvent("on"+c,b)};this.unbind=function(c,b){if(a.img.removeEventListener)a.img.removeEventListener(c,b,false);else a.img.detachEvent&&a.img.detachEvent("on"+c,b)}}PxLoader.prototype.addImage=function(d,c,b){var a=new PxLoaderImage(d,c,b);this.add(a);return a.img}