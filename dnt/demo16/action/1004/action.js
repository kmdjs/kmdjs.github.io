(function(){for(var c=0,b=["ms","moz","webkit","o"],a=0;a<b.length&&!window.requestAnimationFrame;++a){window.requestAnimationFrame=window[b[a]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[b[a]+"CancelAnimationFrame"]||window[b[a]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame)window.requestAnimationFrame=function(d){var b=+new Date,a=Math.max(0,16-(b-c)),e=window.setTimeout(function(){d(b+a)},a);c=b+a;return e};if(!window.cancelAnimationFrame)window.cancelAnimationFrame=function(a){clearTimeout(a)}})();(function(b){var a=function(a,b){this.x=a||0;this.y=b||0};a.prototype={"set":function(a,b){this.x=a;this.y=b;return this},sub:function(b){return new a(this.x-b.x,this.y-b.y)},multiplyScalar:function(a){this.x*=a;this.y*=a;return this},divideScalar:function(a){if(a){this.x/=a;this.y/=a}else this.set(0,0);return this},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},lengthSq:function(){return this.x*this.x+this.y*this.y},distanceToSquared:function(c){var a=this.x-c.x,b=this.y-c.y;return a*a+b*b},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},setLength:function(a){return this.normalize().multiplyScalar(a)}};b.Vector2=a})(window);(function(b){var a=function(c,d,b,a,e){this.color=e;this.radius=c;this.velocity=d;this.position=b;this.collectionPosition=a};a.prototype={collection:function(a){this.velocity=this.collectionPosition.sub(this.position).setLength(a)},disband:function(){this.velocity=new Vector2(MathHelp.getRandomNumber(-230,230),MathHelp.getRandomNumber(-230,230))}};b.Ball=a})(window);(function(b){var a=function(){};a.getRandomNumber=function(a,b){return a+Math.floor(Math.random()*(b-a+1))};b.MathHelp=a})(window);(function(k){var s,b,q="action/1/",o=document.getElementById("canvasMove"),c=o.getContext("2d"),d=[],a=[],e=0,g=15,t=80,f=false,r,j;function m(){p();i()}function p(){var h=b.getContext("2d").getImageData(0,0,b.width,b.height);a.length=0;d.length=0;for(var f=h.data,e=0;e<f.length;e+=4)f[e]+f[e+1]+f[e+2]+f[e+3]!=0&&f[e]+f[e+1]+f[e+2]+f[e+3]!=1020&&d.push({px:e/4%b.width,py:parseInt(e/4/b.width),color:"rgba("+f[e]+","+f[e+1]+","+f[e+2]+","+f[e+3]/255+")"});for(var e=0;e<300;e+=1){var g=MathHelp.getRandomNumber(0,d.length-1),i=new Ball(1,new Vector2(0,0),new Vector2(d[g].px,d[g].py),new Vector2(d[g].px,d[g].py),d[g].color);a.push(i)}for(var e in a){c.fillStyle=a[e].color;c.beginPath();c.arc(a[e].position.x,a[e].position.y,a[e].radius,0,Math.PI*2,true);c.closePath();c.fill()}for(var e in a)a[e].disband()}function i(){j=requestAnimationFrame(i);c.clearRect(0,0,b.width,b.height);e+=g;var k=true;for(var d in a){if(a[d].velocity.x!==0||a[d].velocity.y!==0)k=false;if(f===true&&a[d].position.distanceToSquared(a[d].collectionPosition)<9){e=0;a[d].velocity.y=0;a[d].velocity.x=0}}if(k){h();f=false;cancelAnimationFrame(j)}if(e===1500){e=0;f=true;for(var d in a)a[d].collection(200)}for(var d in a){c.fillStyle=a[d].color;c.beginPath();c.arc(a[d].position.x,a[d].position.y,a[d].radius,0,Math.PI*2,true);c.fill();if(a[d].radius+a[d].position.x>b.width){a[d].position.x=b.width-a[d].radius;a[d].velocity.x*=-1}if(a[d].position.x<a[d].radius){a[d].position.x=a[d].radius;a[d].velocity.x*=-1}if(a[d].radius+a[d].position.y>b.height){a[d].position.y=b.height-a[d].radius;a[d].velocity.y*=-1}if(a[d].position.y<a[d].radius){a[d].position.y=a[d].radius;a[d].velocity.y*=-1}a[d].position.y+=a[d].velocity.y*g/1e3;a[d].position.x+=a[d].velocity.x*g/1e3}}function n(){if(bolDo)return;try{document.createElement("canvas").getContext("2d");bolDo=true;b=document.getElementById("canvas");document.getElementById("canvasMove").style.display="block";document.getElementById("canvas").style.display="none";desenho.setEnd();m()}catch(a){objPage.ShowMessage("游览器版本较低<br/>不支持特效功能")}}function h(){bolDo=false;document.getElementById("canvasMove").style.display="none";document.getElementById("canvas").style.display="block";desenho.setDrawStart()}function l(){if(bolDo)return;objPage.ShowConfirm("确认清除画板",0,"objPage.InitBoard(true);objPage.SetLineColor(intOldCol);")}k.DoAction=n;k.EndAction=h;if(document.getElementById("draw_reset"))document.getElementById("draw_reset").onclick=l})(window)