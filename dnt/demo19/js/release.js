var Vector2=function(n,t){this.x=n||0,this.y=t||0},GuideBox,gb;Vector2.prototype={add:function(n){return new Vector2(this.x+n.x,this.y+n.y)},sub:function(n){return new Vector2(this.x-n.x,this.y-n.y)},multiplyScalar:function(n){return this.x*=n,this.y*=n,this},divideScalar:function(n){return n?(this.x/=n,this.y/=n):this.set(0,0),this},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},lengthSq:function(){return this.x*this.x+this.y*this.y},distanceToSquared:function(n){var t=this.x-n.x,i=this.y-n.y;return t*t+i*i},distanceTo:function(n){return Math.sqrt(this.distanceToSquared(n))},setLength:function(n){return this.normalize().multiplyScalar(n)}},GuideBox=function(n){var t;this.stage=new createjs.Stage(n),createjs.Ticker.addListener(this.stage,"tick"),createjs.Ticker.setFPS(60),t=this,this.state="";var i=32,r=37,u=39,f=65,e=68,o=74;this.interval=20,window.onkeyup=function(n){if(!n)var n=window.event;switch(n.keyCode){case i:energyHeld=!0;break;case o:shootHeld=!0;break;case f:t.prev();break;case r:t.prev();break;case e:t.next();break;case u:t.next()}},this.statusIndex=0,this.immediately=!1,this.tweenTargets=[]},GuideBox.prototype.init=function(n){this.tasks=n},GuideBox.prototype.next=function(){var n,t;if(!(this.statusIndex>this.tasks.length)){if(this.state=="playing"){this.completeCurrentTask();return}this.state="playing",n=this.tasks[this.statusIndex];for(t in n)this[t].apply(this,n[t]);this.statusIndex++,this.statusIndex>this.tasks.length&&this.statusIndex--}},GuideBox.prototype.completeCurrentTask=function(){var r,n,t,i;for(this.loop&&clearInterval(this.loop);r=this.tweenTargets.shift();)createjs.Tween.removeTweens(r);n=this.stage.children[this.statusIndex-1],n&&n.parent.removeChild(n),t=this.tasks[this.statusIndex-1],this.immediately=!0;for(i in t)this[i].apply(this,t[i])},GuideBox.prototype.prev=function(){this.state="";if(this.statusIndex!=0){var n=this.stage.children[this.statusIndex-1];n.parent.removeChild(n),this.statusIndex--}},GuideBox.prototype.first=function(){},GuideBox.prototype.last=function(){},GuideBox.prototype.drawRect=function(n,t,i,r,u,f){var e=new createjs.Shape,o,s,h;this.stage.addChild(e),o=this,u=u||3,f=f||"black",this.immediately?(e.graphics.ss(u).beginStroke(f),e.graphics.rect(n,t,i,r),o.state="",this.immediately=!1):(s=sw=4,h=sh=r/i*4,this.loop=setInterval(function(){sw<i?(e.graphics.clear(),e.graphics.ss(u).beginStroke(f),e.graphics.rect(n,t,sw,sh),sw+=s,sh+=h):(o.state="",clearInterval(o.loop))},o.interval))},GuideBox.prototype.drawLine=function(n,t,i,r,u,f){var e=new createjs.Shape;if(this.stage.addChild(e),this.immediately)this.state="",this.immediately=!1,e.graphics.ss(u).beginStroke(f),e.graphics.mt(n,t).lineTo(i,r).cp().es();else{var h=this,s=new Vector2(n,t),c=new Vector2(i,r),a=c.sub(s).normalize(),l=a.setLength(5),o=s.add(l),v=s.distanceToSquared(c);this.loop=setInterval(function(){u=u||4,f=f||"black",o.distanceToSquared(s)<=v?(e.graphics.clear(),e.graphics.ss(u).beginStroke(f),e.graphics.mt(n,t).lineTo(o.x,o.y).cp().es(),o=o.add(l)):(h.state="",clearInterval(h.loop))},h.interval)}},GuideBox.prototype.fillText=function(n,t,i,r,u){var f=new createjs.Text(i,(r||"20")+"px Arial",u||"#FFF"),e;f.y=t,f.x=n,this.immediately?(this.state="",this.immediately=!1,this.stage.addChild(f)):(f.alpha=0,e=this,this.stage.addChild(f),this.tweenTargets.push(f),createjs.Tween.get(f).to({alpha:1},1500).call(function(){e.state=""}))},GuideBox.prototype.drawImage=function(){},GuideBox.prototype.drawCircle=function(){},GuideBox._deepClone=function(n){var r,t,i;if(!n)return n;if(r=[Number,String,Boolean],r.forEach(function(i){n instanceof i&&(t=i(n))}),typeof t=="undefined")if(Object.prototype.toString.call(n)==="[object Array]")t=[],n.forEach(function(n,i){t[i]=GuideBox._deepClone(n)});else if(typeof n=="object")if(n.nodeType&&typeof n.cloneNode=="function")t=n.cloneNode(!0);else if(n.prototype)t=!1&&n.constructor?new n.constructor:n;else if(n instanceof Date)t=new Date(n);else{t={};for(i in n)t[i]=GuideBox._deepClone(n[i])}else t=n;return t},gb=new GuideBox("testCanvas"),gb.init([{drawRect:[200,80,400,200,6]},{drawLine:[280,80,200,280,5,"green"]},{drawLine:[280,80,600,280,5,"blue"]},{drawLine:[280,80,280,280,5,"brown"]},{fillText:[400,100,"面积a1",30,"red"]},{fillText:[320,180,"面积a2",30,"red"]},{fillText:[210,100,"面积b1",15,"#7fb80e"]},{fillText:[230,230,"面积b2",15,"#7fb80e"]},{fillText:[200,300,"a1==a2     b1==b2",40,"#00ae9d"]},{fillText:[140,360," ==>",40,"#f15b6c"]},{fillText:[230,340,"Area=w*h/2",60,"#426ab3"]}])